!!! Strict
%html{ "xml:lang" => "en", :lang => "en", :xmlns => "http://www.w3.org/1999/xhtml" }
  %head
    %title
      = @page_title || APP_CONFIG[:site_name]
    %meta{ :content => "text/xhtml; charset=utf-8", "http-equiv" => "content-type" }
    %meta{ :content => "no", "http-equiv" => "imagetoolbar" }
    %meta{ :name => "distribution", :content => "all" }
    %meta{ :name => "robots", :content => "all" }
    %meta{ :name => "resource-type", :content => "document" }
    %meta{ :name => "MSSmartTagsPreventParsing", :content => "true" }
    = stylesheet_link_tag 'app'
    = stylesheet_link_tag 'accordion'
    = stylesheet_link_tag 'window'
    = stylesheet_link_tag 'rites-dialog'
    = stylesheet_link_tag 'live_validation'
    
    / = javascript_include_tag :defaults
    = javascript_include_tag "prototype"
    = javascript_include_tag "effects"
    = javascript_include_tag "prototype-ui/prototype-ui"
    = javascript_include_tag "dragdrop"
    = javascript_include_tag "misc/resizable"
    / i would like to get rid of all the livepipe stuff..
    = javascript_include_tag "livepipe/livepipe"
    / = javascript_include_tag "livepipe/tabs"
    = javascript_include_tag "livepipe/window"
    = javascript_include_tag "live_validation"
    = javascript_include_tag "cookie"
    = javascript_include_tag "accordion"    
    = javascript_include_tag "controls"
    /[if IE]
      = javascript_include_tag "flotr/excanvas"
    = javascript_include_tag "flotr/flotr"
    / = javascript_include_tag "in_place_rich_editor/patch_inplaceeditor_1-8-1.js"
    / = javascript_include_tag "in_place_rich_editor/patch_inplaceeditor_editonblank_1-8-1.js"
    / = javascript_include_tag "in_place_rich_editor/inplacericheditor.js"
    = javascript_include_tag "tiny_mce/tiny_mce"
    / lets load the applications js last...
    = javascript_include_tag "application"
    
    :javascript
      tinyMCE.init({
        mode : "textareas",
        theme : "advanced",
        theme_advanced_buttons1     : "justifyleft,justifycenter,justifyright,justifyfull,|,bold,italic,underline,strikethrough,",
        theme_advanced_buttons1_add : "|,fontselect,fontsizeselect|,bullist,numlist,hr|,undo,redo,link,unlink,image",
        theme_advanced_buttons2 : "",
        theme_advanced_buttons3 : "",
        theme_advanced_toolbar_location : "top",
        theme_advanced_toolbar_align : "left",
        theme_advanced_statusbar_location : "bottom",
        theme_advanced_resizing : true
      });
  %body
    
    
    #body2
      /
        For non-visual user agents:
      #top
        %a.hidden.doNotPrint{ :href => "#main_content" }
          Skip to main content.
    #wrapper.wrapper
      = render :partial => 'shared/investigation_trail'
      #header
        %span.left_content
          %h1 RITES Authoring
        %span.right_content
          Welcome
          = "#{current_user.name}."
          - unless current_user.anonymous?
            = link_to 'Preferences', preferences_user_path(current_user)
            \/
            = link_to 'Logout', logout_path
          - else
            = link_to 'Login', login_path
            \/
            = link_to 'Signup', signup_path
            
      #nav_top
        %span.hidden.doNotPrint
          Navigation:
        != "&nbsp;"
        / = yield :navigation_trail
        %ul.menu_h
          %li.trail= link_to 'Home', home_path
          %li.trail= link_to 'Investigations', investigations_path
          %li.trail= link_to 'My Investigations', :controller=> :investigations, :action=> :index, :mine_only => 'y'
          %li.trail= link_to 'GSEs', grade_span_expectations_path
            
      #left_nav.nav_menu
        .padded_content
        - if @investigation
          #accordion_nav
            - sectionlistname = dom_id_for(@investigation, :section_list)
            %ul{:id=>sectionlistname, :class=>"accordian_header"}
              = link_to @investigation.name, @investigation
              - @investigation.sections.each do |section|
              
                %li{:id=>dom_id_for(section,:item), :class=>"accordion_container"}
                  .accordion_name
                    -if defined? @section
                      -if @section.id == section.id
                        = link_to section.name,section, :class=> 'selected'
                      -else 
                        =link_to section.name,section
                    -else
                      =link_to section.name, section
                  
                  .accordion_toggle
                  -pagelistname = dom_id_for(section, :page_list)
                  %ul{:id=>pagelistname, :class=>'accordion_content'}
                    - section.pages.each do |p|
                      %li{:id => dom_id_for(p, :item), :class => 'accordion_page'}
                        .accordion_page_link
                          -if defined? @page
                            -if @page.id == p.id
                              = link_to p.name,p, :class=> 'selected'
                            -else 
                              =link_to p.name,p
                          -else
                            =link_to p.name,p
                  =sortable_element pagelistname.to_sym, :url=> {:controller=> :sections, :action => 'sort_pages', :params => {:list_name=>pagelistname,:id => section.id }}
              =sortable_element sectionlistname.to_sym, :url=> {:controller=> :investigations, :action => 'sort_sections', :params => {:list_name=>sectionlistname,:id => @investigation.id }}
            
          / 
            = yield :sidebar
            %hr
            %p
            = render :partial => 'shared/vendor_interface', :locals => { :vendor_interface => current_user.vendor_interface }
            %hr
            %p
              %span.sideBarText
                Rhode Island Technology Enhanced Science 
                %em (RITES) 
                program is a targeted Math-Science Partnership designed to improve secondary science learning statewide.
            %hr
              %p.small
                Validate the
                %a{ :href => "http://validator.w3.org/check/referer" }
                  XHTML
                and
                %a{ :href => "http://jigsaw.w3.org/css-validator/check/referer" }
                  CSS of this page.
            %hr
              = render :partial => 'shared/site_info'
          


      #content_header.main_content_colors
        = yield :content_header
      #main_content.main_content_colors
        #flash
          - flash.each do |key, message|
            %div{:class=>"flash flash_#{key}"}= message
        = yield :layout



      #footer
        .padded_content
          #footer_left
            Questions/Feedback:
            = mail_to("stephen@concord.org", "Send us an email", :subject => "rights question", :encode => "javascript")
          #footer_right
            / footer text on the right
  #teacher_bottom 
    = link_to_function 'teacher-notes', visual_effect(:toggle_blind, 'some_data',:duration => 0.25)
    #some_data{:style=>"display: none;"}
      = yield :teacher_note