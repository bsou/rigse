- form_for(@activity, :html => {:onsubmit => "return template_handle_onsubmit()"}) do |f|
  %h3 Activity #{@activity.id} Name
  = f.text_field(:name, :size => '72')
  %h3 publication status
  = f.select :publication_status, activity_status_options
  - if current_user.has_role?('admin','manager')
    %h3 exemplar activity
    = f.check_box :is_exemplar
  - if current_user.has_role?('admin','manager')
    %h3 grade level:
    = grade_level_select
    %h3 subject area:
    = subject_area_select
    %h3 unit:
    = unit_select
  %h3 description
  -#= f.hidden_field :redirect, activity_template_edit(@activity)
  = f.text_area(:description, :class => 'mceNoEditor',:cols => '72', :rows => '5')
  %p
  = @activity.lightweight? ? link_to('preview', polymorphic_path(@activity)) : preview_link_for(@activity, nil, :no_button => true)
  = f.submit "save"
- @activity.sections.each do |section|
  = template_container_for(section, :type => 'template_section', :no_edit => true) do
    %div.template_view_container{:id => dom_id_for(section, :template_view_container)}
      %label
        %input{:type => "checkbox", :name => "enable section", :class=> "template_enable_check"}
        %span{:class => "template_section_title"}
          = section.name
      - section.pages.each do |page|
        = render :partial => 'pages/template_edit', :locals => {:page => page }

%script{:src => "//lab.concord.org/lab/lab.iframe-phone.js"}
:javascript
  window.phones = {};

  window.setupPhone = function(id) {
    setTimeout(function() {
      var phone = phones[id];

      phone.addDispatchListener('play', function() {
        for (var phoneId in phones) {
          if (phoneId == id) { continue; }
          // Tell the model to pause
          var phone = phones[phoneId];
          phone.post({'type': 'stop'});
        }
      }, []);
    }, 10);
  }

  window.createPhone = function(id) {
    return new Lab.IFramePhone($j(id)[0], null, function() {
      setupPhone(id);
    });
  }

- if Labbook.enabled? && !current_user.anonymous?
  #labbook-outer
    .content
      #labbook-cover
      .title-bar
        %span.title
          Snapshot Album
        %span.controls
          %a{:href => '#', :onclick => 'hide_labbook(); return false;'}= "Close"
      #labbook-loading= "Loading. Please wait..."
      %iframe#labbook
  :javascript
    $j(function() {
      var hideCover = function() {
        $j("#labbook-cover").hide();
      };
      var showCover = function() {
        $j("#labbook-cover").show();
      };
      $j("#labbook-outer").draggable({
        start: showCover,
        stop: hideCover
      });
      $j("#labbook-outer").draggable("disable");
      $j("#labbook-outer .content").resizable({
        handles: "e,s,se",
        start: showCover,
        stop: hideCover
      });
      $j("#labbook-outer .content").resizable("disable");
      $j("#labbook").load(function() {
        $j("#labbook-loading").hide();
      });

      window.hide_labbook = function() {
        $j("#labbook-outer").draggable("disable");
        $j("#labbook-outer .content").resizable("disable");
        $j("#labbook-outer").hide();
      }

      window.show_labbook = function(url) {
        $j("#labbook-loading").show();
        $j("#labbook").attr("src", url);
        $j("#labbook-outer").show();
        $j("#labbook-outer").draggable("enable");
        $j("#labbook-outer .content").resizable("enable");
      }

      window.hide_labbook();
    });
